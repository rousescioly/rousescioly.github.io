<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Upcoming Events - Rouse SciOly</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="card">
        <div class="content">
            <h1>Upcoming Events <img class="tab-icon" src="../assets/upcomingEvents.svg"></h1>
            <p>Don't miss what's coming up!</p>
        </div>
        <canvas id="waveCanvas"></canvas>
        <div class="about-section" id="about-section">
            <div class="events-container">
                <div class="events-grid" id="events-grid">
                    <div class="events-loading">Loading events...</div>
                </div>
            </div>
            <footer class="site-footer special">
                <div class="footer-left">
                    Made with <img src="../assets/heart.svg" alt="heart" class="heart-beat"> by <a href="https://sandeepshenoy.dev" target="_blank" rel="noopener">sandeepshenoy.dev</a><span class="footer-separator"> ‚Ä¢ </span><span class="footer-maintained">Maintained by Rouse SciOly Officers</span>
                </div>
                <div class="footer-right">
                    <a href="https://github.com/rousescioly/rousescioly.github.io" target="_blank" rel="noopener" aria-label="GitHub">
                        <img src="../assets/github.svg" alt="GitHub">
                    </a>
                    <a href="https://www.instagram.com/rousescioly/" target="_blank" rel="noopener" aria-label="Instagram">
                        <img src="../assets/insta.svg" alt="Instagram">
                    </a>
                </div>
            </footer>
        </div>
    </div>

    <div class="event-modal-overlay" id="event-modal-overlay">
        <div class="event-modal">
            <button class="event-modal-close" id="event-modal-close">&times;</button>
            <div class="event-modal-header" id="event-modal-header"></div>
            <div class="event-modal-content">
                <h2 id="event-modal-title"></h2>
                <div class="event-modal-details">
                    <div class="event-modal-detail">
                        <span class="event-modal-icon">üìÖ</span>
                        <span id="event-modal-date"></span>
                    </div>
                    <div class="event-modal-detail">
                        <span class="event-modal-icon">üïê</span>
                        <span id="event-modal-time"></span>
                    </div>
                    <div class="event-modal-detail">
                        <span class="event-modal-icon">üìç</span>
                        <span id="event-modal-location"></span>
                    </div>
                </div>
                <p id="event-modal-description"></p>
            </div>
        </div>
    </div>

<script src="../script.js"></script>
<script>
(function() {
    const API_URL = 'https://sandeepshenoy.dev/rso/scioly.json';
    
    function formatDate(timestamp) {
        const date = new Date(timestamp * 1000);
        return date.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }
    
    function formatTime(timestamp) {
        const date = new Date(timestamp * 1000);
        return date.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
        });
    }
    
    function formatShortDate(timestamp) {
        const date = new Date(timestamp * 1000);
        const month = date.toLocaleDateString('en-US', { month: 'short' });
        const day = date.getDate();
        return { month, day };
    }
    
    function getImageUrl(img) {
        if (!img || img === 'fallback.jpg') {
            return '../assets/headers/fallback.jpg';
        }
        if (img.startsWith('http://') || img.startsWith('https://')) {
            return img;
        }
        return '../assets/headers/' + img;
    }
    
    function createEventCard(event) {
        const { month, day } = formatShortDate(event.datetime);
        const card = document.createElement('div');
        card.className = 'event-card';
        card.innerHTML = `
            <div class="event-card-image" style="background-image: url('${getImageUrl(event.img)}')">
                <div class="event-card-date">
                    <span class="event-card-month">${month}</span>
                    <span class="event-card-day">${day}</span>
                </div>
            </div>
            <div class="event-card-content">
                <h3 class="event-card-title">${event.title}</h3>
                <p class="event-card-location">${event.location}</p>
            </div>
        `;
        card.addEventListener('click', () => openModal(event));
        return card;
    }
    
    function openModal(event) {
        const overlay = document.getElementById('event-modal-overlay');
        document.getElementById('event-modal-header').style.backgroundImage = `url('${getImageUrl(event.img)}')`;
        document.getElementById('event-modal-title').textContent = event.title;
        document.getElementById('event-modal-date').textContent = formatDate(event.datetime);
        document.getElementById('event-modal-time').textContent = formatTime(event.datetime);
        document.getElementById('event-modal-location').textContent = event.location;
        document.getElementById('event-modal-description').textContent = event.description;
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        const overlay = document.getElementById('event-modal-overlay');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    }
    
    async function loadEvents() {
        const grid = document.getElementById('events-grid');
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            if (data.events && data.events.length > 0) {
                grid.innerHTML = '';
                data.events.forEach(event => {
                    grid.appendChild(createEventCard(event));
                });
            } else {
                grid.innerHTML = '<div class="events-empty">No upcoming events at the moment.</div>';
            }
        } catch (error) {
            console.error('Failed to load events:', error);
            grid.innerHTML = '<div class="events-error">Failed to load events. Please try again later.</div>';
        }
    }
    
    document.getElementById('event-modal-close').addEventListener('click', closeModal);
    document.getElementById('event-modal-overlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
    });
    
    loadEvents();
})();
</script>
</body>
</html>
