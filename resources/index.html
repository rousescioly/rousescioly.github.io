<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Resources - Rouse SciOly</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="card">
        <div class="content">
            <h1>Resources <img class="tab-icon" src="../assets/resources.svg"></h1>
            <p>Prep smarter, compete stronger.</p>
        </div>
        <canvas id="waveCanvas"></canvas>
        <div class="about-section" id="about-section">
            <div class="events-container">
                <div class="events-grid" id="resources-grid">
                    <div class="events-loading">Loading resources...</div>
                </div>
            </div>
            <footer class="site-footer special">
                <div class="footer-left">
                    Made with <img src="../assets/heart.svg" alt="heart" class="heart-beat"> by <a href="https://sandeepshenoy.dev" target="_blank" rel="noopener">sandeepshenoy.dev</a><span class="footer-separator"> • </span><span class="footer-maintained">Maintained by Rouse SciOly Officers</span>
                </div>
                <div class="footer-right">
                    <a href="https://github.com/rousescioly/rousescioly.github.io" target="_blank" rel="noopener" aria-label="GitHub">
                        <img src="../assets/github.svg" alt="GitHub">
                    </a>
                    <a href="https://www.instagram.com/rousescioly/" target="_blank" rel="noopener" aria-label="Instagram">
                        <img src="../assets/insta.svg" alt="Instagram">
                    </a>
                </div>
            </footer>
        </div>
    </div>

    <div class="event-modal-overlay" id="resource-modal-overlay">
        <div class="event-modal">
            <button class="event-modal-close" id="resource-modal-close">&times;</button>
            <div class="event-modal-header" id="resource-modal-header"></div>
            <div class="event-modal-content">
                <div class="resource-modal-title-row">
                    <img class="resource-modal-icon" id="resource-modal-icon" src="" alt="">
                    <h2 id="resource-modal-title"></h2>
                </div>
                <p id="resource-modal-description"></p>
                <div class="resource-modal-link-container">
                    <a href="" id="resource-modal-link" class="resource-modal-link" target="_blank" rel="noopener">
                        <span>Open Resource</span>
                        <span class="resource-link-arrow">→</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

<script src="../script.js"></script>
<script>
(function() {
    const API_URL = 'https://sandeepshenoy.dev/rso/scioly.json';
    
    function getImageUrl(img) {
        if (!img || img === 'fallback.jpg') {
            return '../assets/headers/fallback.jpg';
        }
        if (img.startsWith('http://') || img.startsWith('https://')) {
            return img;
        }
        return '../assets/headers/' + img;
    }
    
    function getIconUrl(icon) {
        if (!icon) {
            return '';
        }
        if (icon.startsWith('http://') || icon.startsWith('https://')) {
            return icon;
        }
        return '../assets/icons/' + icon;
    }
    
    function createResourceCard(resource) {
        const card = document.createElement('div');
        card.className = 'event-card';
        card.innerHTML = `
            <div class="event-card-image" style="background-image: url('${getImageUrl(resource.header)}')">
            </div>
            <div class="event-card-content">
                <div class="resource-card-title-row">
                    <img class="resource-card-icon" src="${getIconUrl(resource.icon)}" alt="">
                    <h3 class="event-card-title">${resource.title}</h3>
                </div>
            </div>
        `;
        card.addEventListener('click', () => openModal(resource));
        return card;
    }
    
    function openModal(resource) {
        const overlay = document.getElementById('resource-modal-overlay');
        document.getElementById('resource-modal-header').style.backgroundImage = `url('${getImageUrl(resource.header)}')`;
        document.getElementById('resource-modal-icon').src = getIconUrl(resource.icon);
        document.getElementById('resource-modal-title').textContent = resource.title;
        document.getElementById('resource-modal-description').textContent = resource.description;
        document.getElementById('resource-modal-link').href = resource.link;
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        const overlay = document.getElementById('resource-modal-overlay');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    }
    
    async function loadResources() {
        const grid = document.getElementById('resources-grid');
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            if (data.resources && data.resources.length > 0) {
                grid.innerHTML = '';
                data.resources.forEach(resource => {
                    grid.appendChild(createResourceCard(resource));
                });
            } else {
                grid.innerHTML = '<div class="events-empty">No resources here at the moment.</div>';
            }
        } catch (error) {
            console.error('Failed to load resources:', error);
            grid.innerHTML = '<div class="events-error">Failed to load resources. Please try again later. Note: sandeepshenoy.dev must be unblocked to view items.</div>';
        }
    }
    
    document.getElementById('resource-modal-close').addEventListener('click', closeModal);
    document.getElementById('resource-modal-overlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
    });
    
    loadResources();
})();
</script>
</body>
</html>
